name: ðŸš€ Build and deploy (template)
on:
  push:
    branches: [playground]
  pull_request:
    branches: [main]
    types: [closed]

jobs:
  deploy-playground:
    name: Deploy to staging (FTP)
    if: github.event_name == 'push' && startsWith(github.ref, 'refs/heads/playground')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm ci

      - name: Build site
        run: npm run build

      - name: Sync files to staging
        uses: SamKirkland/FTP-Deploy-Action@v4.3.5
        with:
          server: ${{ secrets.FTP_SERVER }}
          username: ${{ secrets.FTP_USERNAME }}
          password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./build/
          server-dir: staging/

  # deploy-prod:
  #   name: Deploy to production
  #   if: github.event_name == 'pull_request' && github.event.pull_request.merged == true
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4

  #     - name: Install dependencies
  #       run: npm ci

  #     - name: Build site
  #       run: npm run build

  #     - name: Remove admin from production build
  #       run: rm -rf build/admin

  #     - name: Sync files to production
  #       uses: SamKirkland/FTP-Deploy-Action@v4.3.5
  #       with:
  #         server: ${{ secrets.FTP_SERVER }}
  #         username: ${{ secrets.FTP_USERNAME }}
  #         password: ${{ secrets.FTP_PASSWORD }}
  #         dangerous-clean-slate: true
  #         local-dir: ./build/
  #         server-dir: www/
